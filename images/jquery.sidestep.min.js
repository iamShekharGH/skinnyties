// Plugin:    jQuery Sidestep 0.0.2
// Author:    Brendan Falkowski http://gravitydept.com
// Copyright: 2012 Gravity Department. All rights reserved.
// License:   http://www.opensource.org/licenses/mit-license.php

;(function($,window,document,undefined){var $window=$(window);var $document=$(document);var Sidestep={defaults:{showNav:true,showNavAlways:false,sidestepAmount:200},init:function(element,options){var self=this;this.config=$.extend({},this.defaults,options);this.element=element;this.$element=$(element);this.$list=this.$element.find(".sidestep-list");this.$listElems=this.$list.children("li");this.$wrapper=this.$element.find(".sidestep-wrapper");this.listPosition=this.getInt(this.$list.css("left"));this.listWidth=0;this.wrapperWidth=0;this.initNav();this.updateState();this.$nav.on("click",function(e){e.preventDefault();self.navClicked(e);});this.$list.on("transitionend webkitTransitionEnd otransitionend",function(){self.updateState();});this.$element.on("movestart",function(e){if((e.distX>e.distY&&e.distX<-e.distY)||(e.distX<e.distY&&e.distX>-e.distY)){e.preventDefault();return;}self.$list.addClass("no-transition");}).on("move",function(e){var move=e.deltaX;var moveSlow=e.deltaX/2.5;if(self.checkLeftBoundary()||self.checkRightBoundary()){self.$list.css("left","+="+moveSlow+"px");}else{self.$list.css("left","+="+move+"px");}}).on("moveend",function(e){self.$list.removeClass("no-transition");if(self.checkLeftBoundary()){self.prev();}if(self.checkRightBoundary()){self.next();}self.updateState();});$window.on("resize",function(){self.updateState();});},checkLeftBoundary:function(){this.updateListPosition();if(this.listPosition>=0){return true;}return false;},checkRightBoundary:function(){this.updateListPosition();var limit=this.listWidth-this.wrapperWidth;if((this.listPosition*-1)>=limit){return true;}return false;},getInt:function(str){return parseInt(str,10);},getListWidth:function(){var width=0;this.$listElems.each(function(){width+=$(this).width();});return width;},getWrapperWidth:function(){return this.getInt(this.$wrapper.css("width"));},initNav:function(){if(this.config.showNav){var str='<ul class="sidestep-nav">'+'<li><a class="prev" href="#">Previous</a></li>'+'<li><a class="next" href="#">Next</a></li>'+"</ul>";this.$element.append(str);this.$nav=this.$element.find(".sidestep-nav");this.$navNext=this.$nav.find(".next");this.$navPrev=this.$nav.find(".prev");}},navClicked:function(e){if($(e.target).hasClass("next")){this.next();}if($(e.target).hasClass("prev")){this.prev();}},next:function(){this.updateListPosition();var limit=this.listWidth-(this.listPosition*-1)-this.wrapperWidth;if(limit<this.config.sidestepAmount){this.$list.css("left","-="+limit);}else{if(limit>=this.config.sidestepAmount){this.$list.css("left","-="+this.config.sidestepAmount);}}this.updateState();},prev:function(){this.updateListPosition();if(this.listPosition>(this.config.sidestepAmount*-1)){this.$list.css("left",0);}else{if(this.listPosition<0){this.$list.css("left","+="+this.config.sidestepAmount);}}this.updateState();},updateListPosition:function(){this.listPosition=this.getInt(this.$list.css("left"));},updateNav:function(){if(this.config.showNav){if(this.config.showNavAlways===false){if(this.$element.width()>=this.listWidth){this.$nav.addClass("inactive");this.listPosition=0;this.$list.css("left",0);}else{this.$nav.removeClass("inactive");}}if(this.checkRightBoundary()){this.$navNext.addClass("disable");}else{this.$navNext.removeClass("disable");}if(this.checkLeftBoundary()){this.$navPrev.addClass("disable");}else{this.$navPrev.removeClass("disable");}}},updateState:function(){this.listWidth=this.getListWidth();this.wrapperWidth=this.getWrapperWidth();this.$list.css("width",this.listWidth);this.$wrapper.css("max-width",this.listWidth);this.updateNav();}};$.fn.sidestep=function(options){return this.each(function(){var sidestep=$.extend({},Sidestep);sidestep.init(this,options);});};})(jQuery,window,document);
